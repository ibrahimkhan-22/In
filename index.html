<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Policy Portal</title>
  <style>
    :root{--bg:#0f1724;--card:#111827;--accent:#7dd3fc;--muted:#9ca3af;--white:#fff}
    body{font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;background:linear-gradient(180deg,#031024 0%, #071022 100%);color:var(--white);margin:0;padding:32px;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .container{width:100%;max-width:820px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);padding:18px;border-radius:10px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    form .row{display:flex;gap:12px;flex-wrap:wrap}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=email], input[type=date], select, input[type=time], input[type=number]{
      width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#0b1220;color:var(--white);box-sizing:border-box
    }
    .col{flex:1 1 200px;min-width:160px}
    .actions{display:flex;gap:10px;margin-top:14px}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .hidden{display:none}
    .confirmation{margin-top:16px}
    .fieldBlock{margin-bottom:12px}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Your Policy Portal</h1>
      <nav>
        <button id="logonBtn">Log on</button>
      </nav>
    </header>

    <section id="formSection" class="card hidden">
      <h2 style="margin-top:0">Policy Request Form</h2>
      <form id="policyForm">
        <div class="row">
          <div class="col">
            <label>Title</label>
            <select name="title"><option>Mr</option><option>Ms</option><option>Mrs</option><option>Other</option></select>
          </div>
          <div class="col">
            <label>First name</label>
            <input name="firstName" type="text" required />
          </div>
          <div class="col">
            <label>Last name</label>
            <input name="lastName" type="text" required />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <label>Date of birth</label>
            <input name="dob" type="date" required />
          </div>
          <div class="col">
            <label>Phone number</label>
            <input name="phone" type="text" required />
          </div>
          <div class="col">
            <label>Email</label>
            <input name="email" type="email" required />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <label>Address</label>
            <input name="address" type="text" />
          </div>
          <div class="col">
            <label>Postcode</label>
            <input name="postcode" type="text" />
          </div>
        </div>

        <hr style="border-color:rgba(255,255,255,0.04);margin:14px 0">

        <div class="row">
          <div class="col">
            <label>License number</label>
            <input name="licenseNo" type="text" />
          </div>
          <div class="col">
            <label>License length</label>
            <input name="licenseLength" type="text" placeholder="e.g., 1 year" />
          </div>
          <div class="col">
            <label>Occupation</label>
            <input name="occupation" type="text" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <label>Registration</label>
            <input name="registration" type="text" />
          </div>
          <div class="col">
            <label>Make</label>
            <input name="make" type="text" />
          </div>
          <div class="col">
            <label>Model</label>
            <input name="model" type="text" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <label>Vehicle year</label>
            <input name="vehicleYear" type="number" />
          </div>
          <div class="col">
            <label>Engine size (cc)</label>
            <input name="engineSize" type="text" />
          </div>
          <div class="col">
            <label>Vehicle value (£)</label>
            <input name="vehicleValue" type="number" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <label>Reason for cover</label>
            <input name="reason" type="text" />
          </div>
          <div class="col">
            <label>Start date</label>
            <input name="startDate" type="date" />
          </div>
          <div class="col">
            <label>Start time</label>
            <input name="startTime" type="time" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <label>End date</label>
            <input name="endDate" type="date" />
          </div>
          <div class="col">
            <label>End time</label>
            <input name="endTime" type="time" />
          </div>
          <div class="col">
            <label>Policy price (£)</label>
            <input name="policyPrice" type="number" step="0.01" />
          </div>
        </div>

        <div class="actions">
          <button type="submit">Submit</button>
          <button type="button" class="secondary" id="cancelBtn">Cancel</button>
        </div>
        <p class="small" style="margin-top:8px">By submitting you confirm you have lawful basis to provide this information.</p>
      </form>
    </section>

    <section id="confirmation" class="card hidden">
      <h2 style="margin-top:0">Policy Created</h2>
      <div id="confContent" class="confirmation"></div>
    </section>
  </div>

  <script>
    const logonBtn = document.getElementById('logonBtn');
    const formSection = document.getElementById('formSection');
    const cancelBtn = document.getElementById('cancelBtn');
    const form = document.getElementById('policyForm');
    const conf = document.getElementById('confirmation');
    const confContent = document.getElementById('confContent');

    logonBtn.addEventListener('click', ()=> {
      formSection.classList.toggle('hidden');
      conf.classList.add('hidden');
    });
    cancelBtn.addEventListener('click', ()=> formSection.classList.add('hidden'));

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const formData = new FormData(form);
      const payload = {};
      formData.forEach((v,k)=> payload[k] = v);

      try{
        const resp = await fetch('/api/submit', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!resp.ok) throw new Error('Network error');
        const data = await resp.json();

        confContent.innerHTML = `
          <div class="fieldBlock"><strong>Registration:</strong> ${payload.registration || 'N/A'}</div>
          <div class="fieldBlock"><strong>Policy No:</strong> ${data.policyNo || 'GPC-'+Math.floor(Math.random()*900000)}</div>
          <div class="fieldBlock"><strong>Start:</strong> ${payload.startDate || ''} ${payload.startTime || ''}</div>
          <div class="fieldBlock"><strong>End:</strong> ${payload.endDate || ''} ${payload.endTime || ''}</div>
          <div class="fieldBlock"><strong>Total Paid:</strong> £${Number(payload.policyPrice||0).toFixed(2)}</div>
          <p class="small">A copy of the policy has been emailed to ${payload.email || 'you'}.</p>
        `;
        conf.classList.remove('hidden');
        formSection.classList.add('hidden');
      }catch(err){
        alert('Submit failed: '+err.message);
      }
    });
  </script>
</body>
</html>
